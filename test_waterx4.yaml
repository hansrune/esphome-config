---
#
# Test ball valve
#

########################
# Mandatory part ....
########################
substitutions:
  system_name: waterx4-1
  system_id: waterx4_1
  friendly_name: 4-way watering 1
  description: Test 4-way water valve control 
  encryption_key: !secret esphome_encryption_key
  ota_password: !secret esphome_ota_password

packages:
  device: !include devices/waterx4_esp32c3.yaml
  ########################
  # Optional part ... include below components and sensors as needed
  ########################
  # i2c: !include components/i2c_ball_valve_ctrl_esp32c3.yaml
  # dallas: !include components/1wire_ball_valve_ctrl_esp32c3.yaml

sensor:
  - platform: pulse_counter
    pin: 
      number: GPIO10
      mode:
        input: true
        pullup: true
    name: "${friendly_name} flow"
    id: ${system_id}_flow
    update_interval: 30s
    unit_of_measurement: "L/hr"
    filters:
      - lambda: return (x / 300.0);
    total:
      unit_of_measurement: "L"
      name: "${friendly_name} total"
      filters:
        - lambda: return (x / 300.0);

valve:
  - platform: template
    name: "${friendly_name} a"
    id: ${system_id}_valve_a
    icon: mdi:valve
    open_action:
      - switch.turn_on: valve_a
    close_action:
      - switch.turn_off: valve_a
    stop_action:
      - switch.turn_off: valve_a
    optimistic: true
  - platform: template
    name: "${friendly_name} b"
    id: ${system_id}_valve_b
    icon: mdi:valve
    open_action:
      - switch.turn_on: valve_b
    close_action:
      - switch.turn_off: valve_b
    stop_action:
      - switch.turn_off: valve_b
    optimistic: true
  - platform: template
    name: "${friendly_name} c"
    id: ${system_id}_valve_c
    icon: mdi:valve
    open_action:
      - switch.turn_on: valve_c
    close_action:
      - switch.turn_off: valve_c
    stop_action:
      - switch.turn_off: valve_c
    optimistic: true
  - platform: template
    name: "${friendly_name} d"
    id: ${system_id}_valve_d
    icon: mdi:valve
    open_action:
      - switch.turn_on: valve_d
    close_action:
      - switch.turn_off: valve_d
    stop_action:
      - switch.turn_off: valve_d
    optimistic: true
  